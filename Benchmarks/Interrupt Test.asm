#############################################################
#中断主程序
#############################################################
.text
#############################################################
#堆栈和栈顶指针
#############################################################
addi $sp, $0, 0xfc
addi $gp, $0, 0xfc
addi $s1, $zero,15
nop
nop
nop
mtc0 $s1, $12

#############################################################
#1到100计数
#############################################################
add $s0, $0, $0
addi $s4, $0, 100
addi $s5, $0, 1
loop:
addi $s0, $s0, 1
add $a0, $0, $s0
addi $v0, $0, 34
syscall
sub $s4, $s4, $s5
bne $0, $s4, loop
addi $v0, $0, 10
syscall

#############################################################
#中断服务程序1 显示1的走马灯
#############################################################

###################################################################
#保护现场
###################################################################
sw $s6, 0($gp)
addi $gp, $gp, 4
sw $s4, 0($gp)
addi $gp, $gp, 4
sw $s5, 0($gp)
addi $gp, $gp, 4
sw $s0, 0($gp)
addi $gp, $gp, 4
sw $a0, 0($gp)
addi $gp, $gp, 4
sw $v0, 0($gp)
addi $gp, $gp, 4

############################
#保护屏蔽字
###########################
mfc0 $s1, $12
nop
nop
nop
sw $s1, 0($gp)
addi $gp, $gp, 4
##########################
#设置新的屏蔽字
##########################
andi $s1, $s1, 0 
ori $s1, $s1, 12
nop
nop
nop
mtc0 $s1, $12
###################################
#开中断
##################################
mfc0 $s1, $12
nop
nop
nop
ori $s1, $s1, 1
nop
nop
nop
mtc0 $s1, $12

add $s6, $zero, $zero
add $s4, $zero, $zero
add $s5, $zero, $zero
add $s0, $zero, $zero
add $a0, $zero, $zero
add $v0, $zero, $zero

addi $s6,$zero,1       #中断号1
addi $s4,$zero,2       #循环次数
addi $s5,$zero,1       #计数器累加值
###################################################################
#逻辑左移，每次移动4位
#显示区域依次显示0x00000001 0x00000010 0x0000100 0x00001000 ... 10000000 1次
###################################################################
IntLoop1:
add $s0,$zero,$s6   

IntLeftShift1:       
add    $a0,$0,$s0       #display $s0
addi   $v0,$0,34         # display hex
syscall                 # we are out of here.   
sll $s0, $s0, 4  
bne $s0, $zero, IntLeftShift1
sub $s4,$s4,$s5      #循环次数递减
bne $s4, $zero, IntLoop1
syscall

##########################
#关中断
##########################
mfc0 $s1, $12
nop
nop
nop
andi $s1, $s1, 0xe
nop
nop
nop
mtc0 $s1, $12

#############################################################
#恢复pingbizi
#############################################################
addi $gp, $gp, -4
lw $s1, 0($gp)
#############################################################
#恢复现场
#############################################################
addi $gp, $gp, -4
lw $v0, 0($gp)
addi $gp, $gp, -4
lw $a0, 0($gp)
addi $gp, $gp, -4
lw $s0, 0($gp)
addi $gp, $gp, -4
lw $s5, 0($gp)
addi $gp, $gp, -4
lw $s4, 0($gp)
addi $gp, $gp, -4
lw $s6, 0($gp)

#######################
# 开中断
######################
ori $s1, $s1, 1
nop
nop
nop
mtc0 $s1, $12

#############################################################
#中断返回
#############################################################
addi $gp, $gp, -4
nop
nop
nop
eret

#############################################################
#中断服务程序2 显示2的走马灯
#############################################################

###################################################################
#保护现场
###################################################################
sw $s6, 0($gp)
addi $gp, $gp, 4
sw $s4, 0($gp)
addi $gp, $gp, 4
sw $s5, 0($gp)
addi $gp, $gp, 4
sw $s0, 0($gp)
addi $gp, $gp, 4
sw $a0, 0($gp)
addi $gp, $gp, 4
sw $v0, 0($gp)
addi $gp, $gp, 4

############################
#保护屏蔽字
###########################
mfc0 $s1, $12
nop
nop
nop
sw $s1, 0($gp)
addi $gp, $gp, 4
##########################
#设置新的屏蔽字
##########################
andi $s1, $s1, 0 
ori $s1, $s1, 8
nop
nop
nop
mtc0 $s1, $12
###################################
#开中断
##################################
mfc0 $s1, $12
nop
nop
nop
ori $s1, $s1, 1
nop
nop
nop
mtc0 $s1, $12

add $s6, $zero, $zero
add $s4, $zero, $zero
add $s5, $zero, $zero
add $s0, $zero, $zero
add $a0, $zero, $zero
add $v0, $zero, $zero

addi $s6,$zero,2       #中断号2
addi $s4,$zero,2       #循环次数
addi $s5,$zero,1       #计数器累加值
###################################################################
#逻辑左移，每次移动4位
#显示区域依次显示0x00000001 0x00000010 0x0000100 0x00001000 ... 10000000 1次
###################################################################
IntLoop2:
add $s0,$zero,$s6

IntLeftShift2:
add    $a0,$0,$s0       #display $s0
addi   $v0,$0,34         # display hex
syscall                 # we are out of here.
sll $s0, $s0, 4
bne $s0, $zero, IntLeftShift2
sub $s4,$s4,$s5      #循环次数递减
bne $s4, $zero, IntLoop2
syscall

##########################
#关中断
##########################
mfc0 $s1, $12
nop
nop
nop
andi $s1, $s1, 0xe
nop
nop
nop
mtc0 $s1, $12

#############################################################
#恢复pingbizi
#############################################################
addi $gp, $gp, -4
lw $s1, 0($gp)
#############################################################
#恢复现场
#############################################################
addi $gp, $gp, -4
lw $v0, 0($gp)
addi $gp, $gp, -4
lw $a0, 0($gp)
addi $gp, $gp, -4
lw $s0, 0($gp)
addi $gp, $gp, -4
lw $s5, 0($gp)
addi $gp, $gp, -4
lw $s4, 0($gp)
addi $gp, $gp, -4
lw $s6, 0($gp)

#######################
#开中断
######################
ori $s1, $s1, 1
nop
nop
nop
mtc0 $s1, $12

#############################################################
#中断返回
#############################################################
addi $gp, $gp, -4
nop
nop
nop
eret

#############################################################
#中断服务程序3 显示3的走马灯
#############################################################

###################################################################
#保护现场
###################################################################
sw $s6, 0($gp)
addi $gp, $gp, 4
sw $s4, 0($gp)
addi $gp, $gp, 4
sw $s5, 0($gp)
addi $gp, $gp, 4
sw $s0, 0($gp)
addi $gp, $gp, 4
sw $a0, 0($gp)
addi $gp, $gp, 4
sw $v0, 0($gp)
addi $gp, $gp, 4

############################
#保护屏蔽字
###########################
mfc0 $s1, $12
nop
nop
nop
sw $s1, 0($gp)
addi $gp, $gp, 4
##########################
#设置新的屏蔽字
##########################
andi $s1, $s1, 0 
ori $s1, $s1, 0
nop
nop
nop
mtc0 $s1, $12
###################################
#开中断
##################################
mfc0 $s1, $12
nop
nop
nop
ori $s1, $s1, 1
nop
nop
nop
mtc0 $s1, $12

add $s6, $zero, $zero
add $s4, $zero, $zero
add $s5, $zero, $zero
add $s0, $zero, $zero
add $a0, $zero, $zero
add $v0, $zero, $zero

addi $s6,$zero,3       #中断号3
addi $s4,$zero,2       #循环次数
addi $s5,$zero,1       #计数器累加值
###################################################################
#逻辑左移，每次移动4位
#显示区域依次显示0x00000001 0x00000010 0x0000100 0x00001000 ... 10000000 1次
###################################################################
IntLoop3:
add $s0,$zero,$s6

IntLeftShift3:
add    $a0,$0,$s0       #display $s0
addi   $v0,$0,34         # display hex
syscall                 # we are out of here.
sll $s0, $s0, 4
bne $s0, $zero, IntLeftShift3
sub $s4,$s4,$s5      #循环次数递减
bne $s4, $zero, IntLoop3
syscall

##########################
#关中断
##########################
mfc0 $s1, $12
nop
nop
nop
andi $s1, $s1, 0xe
nop
nop
nop
mtc0 $s1, $12

#############################################################
#恢复屏蔽字
#############################################################
addi $gp, $gp, -4
lw $s1, 0($gp)
#############################################################
#恢复现场
#############################################################
addi $gp, $gp, -4
lw $v0, 0($gp)
addi $gp, $gp, -4
lw $a0, 0($gp)
addi $gp, $gp, -4
lw $s0, 0($gp)
addi $gp, $gp, -4
lw $s5, 0($gp)
addi $gp, $gp, -4
lw $s4, 0($gp)
addi $gp, $gp, -4
lw $s6, 0($gp)

#######################
# 开中断
######################
ori $s1, $s1, 1
nop
nop
nop
mtc0 $s1, $12

#############################################################
#中断返回
#############################################################
addi $gp, $gp, -4
nop
nop
nop
eret

